<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ChatGPT VR Viewer</title>
    <meta name="description" content="A simple VR app using A-Frame with a room, a cube, hand tracking controls, hand models, fog, and art exhibition lighting.">
    <script src="aframe-master.min.js"></script>
    <style>
      .drop-zone {
        position: fixed;
        width: 50%;
        height: 100%;
        border: dashed 4px #888;
        background-color: rgba(255, 255, 255, 0.5);
        display: none;
      }
      #drop-zone-model {
        top: 0;
        left: 0;
      }
      #drop-zone-environment {
        top: 0;
        right: 0;
      }

      #floating-menu,
      #floating-menu-load,
      #floating-info-box{
        position: fixed;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      #floating-menu-load {
        left:10px;
        right:auto;
      }
      #floating-menu-load .menu-button {
        background-color: #79ce12;
      }

      #floating-info-box {
        bottom:10px;
        left:10px;
        top:auto;
        font-size: 10px;
        color:#666;
      }
      #floating-info-box p {
        margin:0;
      }
      #floating-info-box p+p{
        margin-top:0.75em;
      }
      .menu-button {
        background-color: #4cc3d9;
        border: none;
        color: white;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
      }

      #floating-info-box {
        background-color: rgba(255, 255, 255, 0.3);
        padding: 10px;
        border-radius: 5px;
        max-width: 500px;
      }

      #move-light-button {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #4cc3d9;
        border: none;
        color: white;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
      }

       #popup-window {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      #popup-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }
      #close-popup {
        background-color: #4cc3d9;
        border: none;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
      }
    </style>

  </head>
  <body>
    <div id="popup-window">
      <div id="popup-content">
        <h1>Welcome to our VR App</h1>
        <p>Created by:</p>
        <p>OpenAI's ChatGPT &amp; Krzysztof Krystian Jankowski</p>
        <button id="close-popup">Enter the App</button>
      </div>
    </div>

    <a-scene loading-screen="dotsColor: black; backgroundColor: white"
             renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true; toneMapping:ACESFilmic; highRefreshRate:true;"
             shadow="castShadow:true; type:pcfsoft;"
             reflection>
      <a-sky id="hdr-sky" radius="300"></a-sky>

      <!-- Camera setup -->
      <a-entity id="rig" movement-controls="speed: 0.1" position="0 1.6 3">
        <a-entity id="camera" camera look-controls wasd-controls position="0 0 0">
        </a-entity>
        <a-entity id="left-hand" oculus-touch-controls="hand: left" laser-controls="hand: left" raycaster="objects: .teleportable" teleport-controls="cameraRig: #rig; teleportOrigin: #camera; button: trackpad;" buttons-events></a-entity>
        <a-entity id="right-hand" laser-controls="hand: right"  oculus-touch-controls="hand: right" raycaster="objects: .teleportable" teleport-controls="cameraRig: #rig; teleportOrigin: #camera;" buttons-events></a-entity>

      </a-entity>


      <!-- White floor -->
      <a-plane id="whiteFloor" position="0 0 0" rotation="-90 0 0" width="6" height="6" color="#222222" shadow="receive:true; cast:false;"></a-plane>

      <!-- Cube in the center -->
      <a-box id="initialBox" position="0 0.5 0" width="1" height="1" depth="1" color="#F8F8F8" shadow>
        <a-sphere position="0 1 0" radius="0.5" color="#9141ac" roughness="0.01"><a-spere>
      </a-box>

      <!-- Sky -->
      <a-sky color="#ECECEC"></a-sky>

      <a-entity id="customModel" position="0 2 0" scale="1 1 1" shadow="receive:true; cast:true;"></a-entity>

      <!-- Custom environment -->
      <a-entity id="customEnvironment" position="0 0 0" scale="1 1 1" shadow="receive:true; cast:false;"></a-entity>


      <!-- Lighting -->
      <a-light id="light1" position="-2 4 0" light="type:directional; castShadow:true; color:#FFF; intensity:4; target:#customModel; angle:30;"></a-light>
      <a-light id="light2" position="2 4 0" light="type:directional; castShadow:true; color:#FFF; intensity:4; target:#customModel; angle:30;"></a-light>
      <a-light id="light3" position="2 3 2" light="type:directional; castShadow:true; color:#FFF; intensity:4; target:#customModel; angle:160;"></a-light>
      <a-light type="ambient" color="#AAA" intensity="1"></a-light>
    </a-scene>

    <div id="floating-menu">
      <a class="menu-button" href="sample-models/suzane.glb" download="suzane.glb">Download Suzane</a>
      <a class="menu-button" href="sample-models/a-vr-enviro-1.glb" download="a-vr-enviro-1.glb">Download Environment 1</a>
      <a class="menu-button" href="sample-models/a-vr-enviro-2.glb" download="a-vr-enviro-2.glb">Download Environment 2</a>
    </div>

    <div id="floating-menu-load">
      <button class="menu-button" id="load-suzane">Load Suzane</button>
      <button class="menu-button" id="load-enviro-0">Load Environment 0</button>
      <button class="menu-button" id="load-enviro-1">Load Environment 1</button>
      <button class="menu-button" id="load-enviro-2">Load Environment 2</button>
      <button class="menu-button" id="load-sky">Load next sky</button>
    </div>

    <div id="floating-info-box">
      <p>Created by Krzysztof Krystian Jankowski and ChatGPT by OpenIA.</p>
    </div>

    <button id="move-light-button">Move Light</button>

    <div id="drop-zone-model" class="drop-zone">
      <h1 style="text-align: center; margin-top: 40%;">Drop your model .glb file here</h1>
    </div>
    <div id="drop-zone-environment" class="drop-zone">
      <h1 style="text-align: center; margin-top: 40%;">Drop your environment .glb file here</h1>
    </div>

    <script>
      const skyImages = [
        'skys/sky1.jpg',
        'skys/sky2.jpg',
        'skys/sky3.jpg',
        'skys/sky4.jpg',
        'skys/sky5.jpg',
        'skys/sky6.jpg',
        'skys/sky7.jpg',
        'skys/sky8.jpg',
        'skys/sky9.jpg',
        'skys/sky10.jpg'
      ];
      let currentSkyIndex = 0;
      const dropZoneModel = document.getElementById('drop-zone-model');
      const dropZoneEnvironment = document.getElementById('drop-zone-environment');

      function loadModel(url) {
        const modelEntity = document.getElementById('customModel');
        modelEntity.setAttribute('gltf-model', url);
        // Remove the initial environment
        const entity = document.getElementById('initialBox');
        entity.parentNode.removeChild(entity);
      }

      function loadEnvironment(url) {
        const environmentEntity = document.getElementById('customEnvironment');
        environmentEntity.setAttribute('gltf-model', url);

        // Remove the initial environment
        const initialEnvironmentEntities = ['whiteFloor'];
        for (const entityId of initialEnvironmentEntities) {
          const entity = document.getElementById(entityId);
          if (entity) {
            entity.parentNode.removeChild(entity);
          }
        }
      }

      function loadNextSky() {
        currentSkyIndex = (currentSkyIndex + 1) % skyImages.length;
        loadSky(skyImages[currentSkyIndex]);
      }

      document.getElementById('load-suzane').addEventListener('click', () => {
        loadModel('sample-models/suzane.glb');
      });

      document.getElementById('load-enviro-0').addEventListener('click', () => {
        loadEnvironment('sample-models/a-vr-enviro-0.glb');
      });

      document.getElementById('load-enviro-1').addEventListener('click', () => {
        loadEnvironment('sample-models/a-vr-enviro-1.glb');
      });

      document.getElementById('load-enviro-2').addEventListener('click', () => {
        loadEnvironment('sample-models/a-vr-enviro-2.glb');
      });

      document.getElementById('load-sky').addEventListener('click', () => {
        loadNextSky()
      });

      document.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropZoneModel.style.display = 'block';
        dropZoneEnvironment.style.display = 'block';
      });

      dropZoneModel.addEventListener('dragleave', (event) => {
        event.preventDefault();
        dropZoneModel.style.display = 'none';
      });

      dropZoneEnvironment.addEventListener('dragleave', (event) => {
        event.preventDefault();
        dropZoneEnvironment.style.display = 'none';
      });

      dropZoneModel.addEventListener('drop', async (event) => {
        event.preventDefault();
        dropZoneModel.style.display = 'none';
        dropZoneEnvironment.style.display = 'none';

        const file = event.dataTransfer.files[0];
        if (file && file.name.endsWith('.glb')) {
          const modelURL = URL.createObjectURL(file);
          const modelEntity = document.getElementById('customModel');
          modelEntity.setAttribute('gltf-model', modelURL);

          // Remove the initial environment
          const entity = document.getElementById('initialBox');
          entity.parentNode.removeChild(entity);
        }
      });

      dropZoneEnvironment.addEventListener('drop', async (event) => {
        event.preventDefault();
        dropZoneModel.style.display = 'none';
        dropZoneEnvironment.style.display = 'none';

        const file = event.dataTransfer.files[0];
        if (file && file.name.endsWith('.glb')) {
          const environmentURL = URL.createObjectURL(file);
          const environmentEntity = document.getElementById('customEnvironment');
          environmentEntity.setAttribute('gltf-model', environmentURL);

          // Remove the initial environment
          const initialEnvironmentEntities = ['whiteFloor'];
          for (const entityId of initialEnvironmentEntities) {
            const entity = document.getElementById(entityId);
            entity.parentNode.removeChild(entity);
          }
        }
      });

      function randomPosition(radius) {
        const angle = Math.random() * 2 * Math.PI;
        const x = radius * Math.cos(angle);
        const z = radius * Math.sin(angle);
        return { x, y: 5, z };
      }

      function moveLights(lightIds) {
        for (const lightId of lightIds) {
          const light = document.getElementById(lightId);
          const currentPosition = light.getAttribute('position');
          const newPosition = randomPosition(5);

          // Add animation component to the light
          light.setAttribute('animation', {
            property: 'position',
            from: `${currentPosition.x} ${currentPosition.y} ${currentPosition.z}`,
            to: `${newPosition.x} ${newPosition.y} ${newPosition.z}`,
            dur: 2000,
            easing: 'easeInOutQuad',
          });
        }
      }

      document.getElementById('move-light-button').addEventListener('click', () => {
        moveLights(['light1', 'light2', 'light3']);
      });

      function loadSky(url) {
        const sky = document.querySelector('a-sky');
        sky.setAttribute('src', url);
      }



      AFRAME.registerComponent('buttons-events',{
        init: function () {
          this.el.addEventListener('abuttondown', this.loadSky);
          this.el.addEventListener('bbuttondown', this.moveLights2);
          this.el.addEventListener('xbuttondown', this.addSuzane);
          this.el.addEventListener('ybuttondown', this.changeEnviro);
        },
        loadSky: function(){
            const skyUrls =['skys/sky1.jpg', 'skys/sky2.jpg', 'skys/sky3.jpg', 'skys/sky4.jpg', 'skys/sky5.jpg', 'skys/sky6.jpg', 'skys/sky7.jpg', 'skys/sky8.jpg', 'skys/sky9.jpg', 'skys/sky10.jpg'];
            const randomIndex = Math.floor(Math.random() * skyUrls.length);
            loadSky(skyUrls[randomIndex]);
        },
        moveLights2: function(){
          moveLights(['light1', 'light2', 'light3']);
        },
        addSuzane: function(){
          loadModel('sample-models/suzane.glb');
        },
        changeEnviro: function(){
          const enviroUrls = ['sample-models/a-vr-enviro-1.glb', 'sample-models/a-vr-enviro-2.glb'];
          const randomIndex = Math.floor(Math.random() * enviroUrls.length);
          loadEnvironment(enviroUrls[randomIndex]);
        }
      });

        document.getElementById('close-popup').addEventListener('click', () => {
          document.getElementById('popup-window').style.display = 'none';
        });
    </script>
  </body>
</html>
